<!DOCTYPE html>
<html lang="{{ get_locale() }}">
<head>
    <meta charset="UTF-8">
    <title>{{ _('Slider Page') }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="slider-page">
<div class="container">

    <div class="widget current-day">
        <h3>{{ _('Adjust Variables') }}</h3>
        <div class="content-box">

            <!-- DATE -->
            <div class="variable">
                <label for="date">{{ _('Date') }}</label>
                <input type="date" id="date">
            </div>
            
            <!-- HOLIDAY DROPDOWN -->
            <div class="variable">
                <label>{{ _('Holiday Override') }}</label>
                <select id="holiday_name" class="variable-select">
                    <option value="">{{ _('(None)') }}</option>
                    <option value="90_jr_dierenpark">90 jr Dierenpark</option>
                    <option value="allerheiligen">Allerheiligen</option>
                    <option value="bevrijdingsdag">Bevrijdingsdag</option>
                    <option value="dag_van_de_duitse_eenheid">Dag van de Duitse Eenheid</option>
                    <option value="dag_van_de_arbeid">Dag van de arbeid</option>
                    <option value="dierendag">Dierendag</option>
                    <option value="dreamnight">Dreamnight</option>
                    <option value="eerste_kerstdag">Eerste Kerstdag</option>
                    <option value="eerste_paasdag">Eerste Paasdag</option>
                    <option value="eerste_pinksterdag">Eerste Pinksterdag</option>
                    <option value="goede_vrijdag">Goede Vrijdag</option>
                    <option value="goede_vrijdag">Goede vrijdag</option>
                    <option value="halloween">Halloween</option>
                    <option value="hemelvaartsdag">Hemelvaartsdag</option>
                    <option value="hemelvaartsweekend">Hemelvaartsweekend</option>
                    <option value="herfstvakantie">Herfstvakantie</option>
                    <option value="hervormingsdag">Hervormingsdag</option>
                    <option value="kerstvakantie">Kerstvakantie</option>
                    <option value="koningsdag">Koningsdag</option>
                    <option value="meivakantie">Meivakantie</option>
                    <option value="moederdag">Moederdag</option>
                    <option value="nieuwjaarsdag">Nieuwjaarsdag</option>
                    <option value="oudejaarsdag">Oudejaarsdag</option>
                    <option value="oudjaarsdag">Oudjaarsdag</option>
                    <option value="paasvakantie">Paasvakantie</option>
                    <option value="pinkstermaandag">Pinkstermaandag</option>
                    <option value="pinkstervakantie">Pinkstervakantie</option>
                    <option value="rosenmontag">Rosenmontag</option>
                    <option value="sacramentsdag">Sacramentsdag</option>
                    <option value="sacrementsdag">Sacrementsdag</option>
                    <option value="sint_maarten">Sint Maarten</option>
                    <option value="sinterklaas">Sinterklaas</option>
                    <option value="tweede_kerstdag">Tweede Kerstdag</option>
                    <option value="tweede_paasdag">Tweede Paasdag</option>
                    <option value="tweede_pinksterdag">Tweede Pinksterdag</option>
                    <option value="vaderdag">Vaderdag</option>
                    <option value="valentijdsdag">Valentijdsdag</option>
                    <option value="valentijnsdag">Valentijnsdag</option>
                    <option value="voorjaarsvakantie">Voorjaarsvakantie</option>
                    <option value="wintervakantie">Wintervakantie</option>
                    <option value="zomervakantie">Zomervakantie</option>
                </select>
            </div>

            <!-- EVENT DROPDOWN -->
             <div class="variable">
                <label>{{ _('Event Override') }}</label>
                <select id="event_name" class="variable-select">
                    <option value="">{{ _('(None)') }}</option>
                    <option value="4_mijl">4 mijl</option>
                    <option value="90_jaar_zoo_emmen">90 jaar zoo emmen</option>
                    <option value="alles_kids">Alles kids</option>
                    <option value="barrel_food_truck_festival">Barrel food truck festival</option>
                    <option value="bevrijdingsfestival">Bevrijdingsfestival</option>
                    <option value="boerenrock_festival">Boerenrock festival</option>
                    <option value="c'est_la_vie">C'est la vie</option>
                    <option value="c’est_la_vie">C’est la Vie</option>
                    <option value="dierendag_-_wildlands">Dierendag - Wildlands</option>
                    <option value="emmen_on_ice">Emmen on ice</option>
                    <option value="exclusive_avond_abonnement_-_wildlands">Exclusive avond abonnement - Wildlands</option>
                    <option value="fc_emmen_-_ado">Soccer</option>
                    <option value="gouden_pijl">Gouden pijl</option>
                    <option value="hello_festival">Hello festival</option>
                    <option value="herfst_-_wildlands">Herfst - Wildlands</option>
                    <option value="koningsdag">Koningsdag</option>
                    <option value="koningsnacht">Koningsnacht</option>
                    <option value="meivakantie_met_activiteiten_-_wildlands">Meivakantie met activiteiten - Wildlands</option>
                    <option value="midzomerfestival">Midzomerfestival</option>
                    <option value="moederdag_ontbijt_-_wildlands">Moederdag ontbijt - Wildlands</option>
                    <option value="paasontbijt_-_wildlands">Paasontbijt - Wildlands</option>
                    <option value="tt-assen">TT-Assen</option>
                    <option value="uitfestival">Uitfestival</option>
                    <option value="vaderdag_ontbijt-_wildlands">Vaderdag ontbijt- Wildlands</option>
                    <option value="valentijnsdiner_-_wildlands">Valentijnsdiner - Wildlands</option>
                    <option value="voorjaarsvakantie_activiteiten_-_wildlands">Voorjaarsvakantie activiteiten - Wildlands</option>
                    <option value="vroege_vogel_ontbijt_-_wildlands">Vroege vogel ontbijt - Wildlands</option>
                    <option value="wildnights">WILDnights</option>
                    <option value="wildsummer">WILDsummer</option>
                    <option value="c'est_la_vie">c'est la vie</option>
                </select>
            </div>

            <!-- RAIN MORNING -->
            <div class="variable">
                <div class="variable-top">
                    <label for="rain">{{ _('Rain morning') }}</label>
                    <input type="number" id="rain_morning-num" value="0" step="0.5" class="variable-value"> 
                    <span>mm</span>
                </div>
                <div class="variable-slider">
                    <input type="range" id="rain_morning" min="0" max="50" step="0.5" value="0">
                </div>
            </div>

            <!-- RAIN AFTERNOON -->
            <div class="variable">
                <div class="variable-top">
                    <label>{{ _('Rain Afternoon') }}</label>
                    <input type="number" id="rain_afternoon-num" value="0" step="0.5" class="variable-value">
                    <span>mm</span>
                </div>
                <div class="variable-slider">
                    <input type="range" id="rain_afternoon" min="0" max="50" step="0.5" value="0">
                </div>
            </div>

            <!-- PRECIP MORNING -->
            <div class="variable">
                <div class="variable-top">
                    <label>{{ _('Precip Morning') }}</label>
                    <input type="number" id="precip_morning-num" value="0" step="0.5" class="variable-value">
                    <span>mm</span>
                </div>
                <div class="variable-slider">
                    <input type="range" id="precip_morning" min="0" max="50" step="0.5" value="0">
                </div>
            </div>

            <!-- PRECIP AFTERNOON -->
            <div class="variable">
                <div class="variable-top">
                    <label>{{ _('Precip Afternoon') }}</label>
                    <input type="number" id="precip_afternoon-num" value="0" step="0.5" class="variable-value">
                    <span>mm</span>
                </div>
                <div class="variable-slider">
                    <input type="range" id="precip_afternoon" min="0" max="50" step="0.5" value="0">
                </div>
            </div>

            <!-- TEMPERATURE -->
            <div class="variable">
                <div class="variable-top">
                    <label>{{ _('Temperature') }}</label>
                    <input type="number" id="temp-num" value="15" class="variable-value">
                    <span>°C</span>
                </div>
                <div class="variable-slider">
                    <input type="range" id="temp" min="-10" max="35" step="1" value="15">
                </div>
            </div>

        </div>
    </div>

    <div class="widget events">
         <h3>{{ _('Prediction Comparison') }}</h3>
        <div class="content-box">
            <canvas id="comparisonChart" height="220"></canvas>
        </div>
    </div>

    <div class="widget forecast">
        <div class="content-box forecast-box">
            <button class="confirm-button">{{ _('Calculate') }}</button>
            <p class="visitor-count" id="result">—</p>
            <p class="forecast-note">{{ _('Adjusted forecast') }}</p>
        </div>
    </div>

    <div class="widget manual-link">
        <div class="content-box link-box">
            <a href="{{ url_for('home') }}" class="manual-button">{{ _('Dashboard') }}</a>
        </div>
    </div>

</div>

<script>
function sync(id) {
    const range = document.getElementById(id);
    const num = document.getElementById(id + "-num");
    range.addEventListener("input", () => num.value = range.value);
    num.addEventListener("input", () => range.value = num.value);
}

["rain_morning", "rain_afternoon", "precip_morning", "precip_afternoon", "temp"].forEach(sync);

document.getElementById("date").value =
    new Date().toISOString().split("T")[0];

const chart = new Chart(
    document.getElementById("comparisonChart"),
    {
        type: "bar",
        data: {
            labels: ["Visitors"],
            datasets: [
                { label: "Normal prediction", data: [0] },
                { label: "Adjusted (slider)", data: [0] }
            ]
        }
    }
);

document.querySelector(".confirm-button").addEventListener("click", () => {
    const payload = {
        date: document.getElementById("date").value,
        temperature: document.getElementById("temp").value,
        
        holiday_name: document.getElementById("holiday_name").value,
        event_name: document.getElementById("event_name").value,

        rain_morning: document.getElementById("rain_morning").value,
        rain_afternoon: document.getElementById("rain_afternoon").value,

        precip_morning: document.getElementById("precip_morning").value,
        precip_afternoon: document.getElementById("precip_afternoon").value
    };

    console.log("Sending payload:", payload);

    fetch("/api/slider-predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("result").textContent =
            data.adjusted.toLocaleString() + " visitors";

        chart.data.datasets[0].data = [data.baseline];
        chart.data.datasets[1].data = [data.adjusted];
        chart.update();
    });
});
</script>

</body>
</html>
