<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Slider Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="slider-page">
<div class="container">

    <div class="widget current-day">
        <h3>Adjust Variables</h3>
        <div class="content-box">

            <div class="variable">
                <label for="date">Date</label>
                <input type="date" id="date">
            </div>

            <div class="variable">
                <div class="variable-top">
                    <label for="rain">Rainfall</label>
                    <input type="number" id="rain-num" value="0" step="0.5" class="variable-value">
                    <span>mm</span>
                </div>
                <div class="variable-slider">
                    <input type="range" id="rain" min="0" max="20" step="0.5" value="0">
                </div>
            </div>

            <div class="variable">
                <div class="variable-top">
                    <label for="temp">Temperature</label>
                    <input type="number" id="temp-num" value="15" class="variable-value">
                    <span>°C</span>
                </div>
                <div class="variable-slider">
                    <input type="range" id="temp" min="-5" max="35" step="1" value="15">
                </div>
            </div>

        </div>
    </div>

    <div class="widget events">
        <h3>Prediction Comparison</h3>
        <div class="content-box">
            <canvas id="comparisonChart" height="220"></canvas>
        </div>
    </div>

    <div class="widget forecast">
        <div class="content-box forecast-box">
            <button class="confirm-button">Calculate</button>
            <p class="visitor-count" id="result">—</p>
            <p class="forecast-note">Adjusted forecast</p>
        </div>
    </div>

    <div class="widget manual-link">
        <div class="content-box link-box">
            <a href="{{ url_for('home') }}" class="manual-button">Dashboard</a>
        </div>
    </div>

</div>

<script>
function sync(id) {
    const range = document.getElementById(id);
    const num = document.getElementById(id + "-num");
    range.addEventListener("input", () => num.value = range.value);
    num.addEventListener("input", () => range.value = num.value);
}
sync("rain");
sync("temp");

document.getElementById("date").value =
    new Date().toISOString().split("T")[0];

const ctx = document.getElementById("comparisonChart");
const chart = new Chart(ctx, {
    type: "bar",
    data: {
        labels: ["Prediction"],
        datasets: [
            { label: "Normal prediction", data: [0] },
            { label: "Adjusted (slider)", data: [0] }
        ]
    },
    options: {
        responsive: true,
        plugins: { legend: { labels: { color: "#f0f0f0" } } }
    }
});

document.querySelector(".confirm-button").addEventListener("click", () => {
    fetch("/api/slider-predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            date: document.getElementById("date").value,
            rain: document.getElementById("rain").value,
            temperature: document.getElementById("temp").value
        })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("result").textContent =
            data.adjusted.toLocaleString() + " visitors";

        chart.data.datasets[0].data = [data.baseline];
        chart.data.datasets[1].data = [data.adjusted];
        chart.update();
    });
});
</script>

</body>
</html>
