<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Slider Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="slider-page">
<div class="container">

    <!-- LEFT: VARIABLES -->
    <div class="widget current-day">
        <h3>Adjust Variables</h3>
        <div class="content-box">

            <!-- DATE -->
            <div class="variable">
                <label for="date">Date</label>
                <input type="date" id="date">
            </div>

            <!-- RAIN -->
            <div class="variable">
                <label for="rain">Rainfall</label>
                <input type="range" id="rain" min="0" max="20" step="0.5" value="0">
                <input type="number" id="rain-num" value="0" step="0.5" class="variable-value"> mm
            </div>

            <!-- TEMP -->
            <div class="variable">
                <label for="temp">Temperature</label>
                <input type="range" id="temp" min="-5" max="35" step="1" value="15">
                <input type="number" id="temp-num" value="15" class="variable-value"> °C
            </div>

        </div>
    </div>

    <!-- RIGHT: GRAPH -->
    <div class="widget events">
        <h3>Prediction Comparison</h3>
        <div class="content-box">
            <canvas id="comparisonChart" height="220"></canvas>
        </div>
    </div>

    <!-- RESULT -->
    <div class="widget forecast">
        <div class="content-box forecast-box">
            <button class="confirm-button">Calculate</button>
            <p class="visitor-count" id="result">—</p>
            <p class="forecast-note">Adjusted forecast</p>
        </div>
    </div>

    <!-- BACK -->
    <div class="widget manual-link">
        <div class="content-box link-box">
            <a href="{{ url_for('home') }}" class="manual-button">Dashboard</a>
        </div>
    </div>

</div>

<script>
/* Sync sliders & inputs */
function sync(id) {
    const range = document.getElementById(id);
    const num = document.getElementById(id + "-num");
    range.addEventListener("input", () => num.value = range.value);
    num.addEventListener("input", () => range.value = num.value);
}
sync("rain");
sync("temp");

/* Default date = today */
document.getElementById("date").value =
    new Date().toISOString().split("T")[0];

/* Chart */
const ctx = document.getElementById("comparisonChart");
const chart = new Chart(ctx, {
    type: "bar",
    data: {
        labels: ["Prediction"],
        datasets: [
            {
                label: "Normal prediction",
                data: [0],
            },
            {
                label: "Adjusted (slider)",
                data: [0],
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { labels: { color: "#f0f0f0" } }
        },
        scales: {
            x: { ticks: { color: "#a0a0a0" } },
            y: { ticks: { color: "#a0a0a0" } }
        }
    }
});

/* Calculate */
document.querySelector(".confirm-button").addEventListener("click", () => {

    const payload = {
        date: document.getElementById("date").value,
        rain: parseFloat(document.getElementById("rain").value),
        temperature: parseFloat(document.getElementById("temp").value)
    };

    fetch("/save_variables", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(data => {

        /* TEMP MOCK VALUES – backend will replace */
        const normal = 6500;
        const adjusted = 7200;

        document.getElementById("result").textContent =
            adjusted.toLocaleString() + " visitors";

        chart.data.datasets[0].data = [normal];
        chart.data.datasets[1].data = [adjusted];
        chart.update();
    });
});
</script>

</body>
</html>
